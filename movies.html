<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Same head as index.html -->
</head>
<body class="bg-dark text-white">
    <!-- Desktop Navigation -->
    <nav class="navbar hidden md:flex items-center justify-between">
        <div class="flex items-center space-x-8">
            <a href="index.html" class="flex items-center">
                <img src="https://github.com/animeneek/MN/blob/main/assets/Movieneek_Raider%20Crusader_001.png?raw=true" 
                     alt="MovieNeek" 
                     class="h-10">
            </a>
            <div class="flex space-x-6">
                <a href="index.html" class="hover:text-accent">Home</a>
                <a href="movies.html" class="text-accent">Movies</a>
                <a href="tvshows.html" class="hover:text-accent">TV Shows</a>
            </div>
        </div>
        <div class="relative w-64">
            <input type="text" 
                   id="searchInput"
                   placeholder="Search movies..." 
                   class="bg-darkest text-sm px-4 py-2 rounded-full w-full focus:outline-none focus:ring-2 focus:ring-accent">
            <div id="searchResults" class="hidden absolute top-12 left-0 right-0 bg-darkest rounded-lg shadow-lg z-50 p-4 max-h-96 overflow-y-auto"></div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <div class="flex flex-col md:flex-row gap-8">
            <!-- Filters -->
            <aside class="w-full md:w-64 flex-shrink-0">
                <div class="filter-section sticky top-24">
                    <h3 class="text-lg font-bold mb-4">Filters</h3>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">Genres</label>
                        <div id="genreFilters" class="max-h-48 overflow-y-auto"></div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">Release Year</label>
                        <select id="yearFilter" class="bg-darkest text-sm px-3 py-2 rounded w-full">
                            <option value="">All Years</option>
                        </select>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">Sort By</label>
                        <select id="sortBy" class="bg-darkest text-sm px-3 py-2 rounded w-full">
                            <option value="popularity.desc">Popularity</option>
                            <option value="vote_average.desc">Rating</option>
                            <option value="release_date.desc">Newest</option>
                            <option value="release_date.asc">Oldest</option>
                        </select>
                    </div>
                    
                    <button id="applyFilters" class="bg-accent hover:bg-accent-hover w-full py-2 rounded">
                        Apply Filters
                    </button>
                </div>
            </aside>
            
            <!-- Movie Grid -->
            <div class="flex-1">
                <h1 class="text-2xl font-bold mb-6">All Movies</h1>
                
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6" id="moviesGrid">
                    <!-- JS will populate this -->
                </div>
                
                <div class="flex justify-center mt-10">
                    <button id="loadMore" class="bg-accent hover:bg-accent-hover px-6 py-2 rounded">
                        Load More
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav md:hidden flex justify-around">
        <a href="index.html" class="flex flex-col items-center p-2">
            <i class="fas fa-home text-xl"></i>
            <span class="text-xs mt-1">Home</span>
        </a>
        <a href="movies.html" class="flex flex-col items-center p-2 text-accent">
            <i class="fas fa-film text-xl"></i>
            <span class="text-xs mt-1">Movies</span>
        </a>
        <a href="tvshows.html" class="flex flex-col items-center p-2">
            <i class="fas fa-tv text-xl"></i>
            <span class="text-xs mt-1">TV Shows</span>
        </a>
    </nav>

    <script src="assets/js/main.js"></script>
    <script>
        let currentPage = 1;
        let isLoading = false;
        let currentFilters = {
            genres: [],
            year: '',
            sortBy: 'popularity.desc'
        };
        
        // Fetch movies with filters
        async function fetchMovies(page = 1, filters = {}) {
            isLoading = true;
            
            let url = `movie/popular?page=${page}`;
            
            if (filters.genres.length > 0) {
                url = `discover/movie?page=${page}&with_genres=${filters.genres.join(',')}`;
            }
            
            if (filters.year) {
                url += url.includes('?') ? '&' : '?';
                url += `primary_release_year=${filters.year}`;
            }
            
            if (filters.sortBy) {
                url += url.includes('?') ? '&' : '?';
                url += `sort_by=${filters.sortBy}`;
            }
            
            const { results, total_pages } = await fetchTMDB(url);
            isLoading = false;
            
            return { results, total_pages };
        }
        
        // Display movies
        async function displayMovies(append = false) {
            const { results, total_pages } = await fetchMovies(currentPage, currentFilters);
            if (!results) return;
            
            const container = document.getElementById('moviesGrid');
            
            if (!append) {
                container.innerHTML = '';
            }
            
            container.innerHTML += results.map(movie => `
                <a href="details.html?id=${movie.id}&type=movie" class="movie-card block">
                    <div class="relative rounded-lg overflow-hidden aspect-[2/3] mb-2">
                        <img src="${movie.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : 'https://via.placeholder.com/500x750'}" 
                             alt="${movie.title}" 
                             class="movie-poster w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent opacity-0 hover:opacity-100 transition duration-300 flex items-end p-3">
                            <div>
                                <h3 class="font-semibold">${movie.title}</h3>
                                <p class="text-xs text-gray-300">${movie.release_date ? movie.release_date.substring(0, 4) : ''}</p>
                                <span class="absolute top-2 right-2 bg-accent text-xs px-1.5 py-0.5 rounded">${movie.vote_average.toFixed(1)}</span>
                            </div>
                        </div>
                    </div>
                </a>
            `).join('');
            
            // Hide load more button if no more pages
            if (currentPage >= total_pages) {
                document.getElementById('loadMore').classList.add('hidden');
            } else {
                document.getElementById('loadMore').classList.remove('hidden');
            }
        }
        
        // Apply filters
        function applyFilters() {
            currentPage = 1;
            currentFilters.genres = Array.from(document.querySelectorAll('#genreFilters input[type="checkbox"]:checked'))
                .map(checkbox => checkbox.value);
            currentFilters.year = document.getElementById('yearFilter').value;
            currentFilters.sortBy = document.getElementById('sortBy').value;
            
            displayMovies();
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            // Load initial movies
            displayMovies();
            
            // Setup filter apply button
            document.getElementById('applyFilters').addEventListener('click', applyFilters);
            
            // Setup load more button
            document.getElementById('loadMore').addEventListener('click', () => {
                currentPage++;
                displayMovies(true);
            });
        });
    </script>
</body>
</html>
