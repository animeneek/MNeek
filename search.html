<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MovieNeek Search</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            glass: "rgba(255, 255, 255, 0.1)",
            borderGlass: "rgba(255, 255, 255, 0.2)",
          }
        }
      }
    };
  </script>
</head>
<body class="bg-gradient-to-b from-gray-900 to-black text-white min-h-screen">
  <!-- Header -->
  <header class="backdrop-blur-md bg-glass border-b border-borderGlass sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <a href="index.html" class="text-3xl font-extrabold tracking-tight hover:text-indigo-400 transition">
        MovieNeek
      </a>

      <nav class="flex items-center gap-6">
        <!-- Toggle Movies/TV -->
        <div class="flex items-center space-x-2 text-sm font-medium select-none">
          <label class="cursor-pointer relative inline-flex items-center">
            <input type="checkbox" id="toggleType" class="sr-only" />
            <div class="w-12 h-6 bg-gray-700 rounded-full peer peer-focus:ring-2 peer-focus:ring-indigo-500 peer-checked:bg-indigo-600 transition"></div>
            <span class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition peer-checked:translate-x-6"></span>
          </label>
          <span id="typeLabel">Movies</span>
        </div>
      </nav>
    </div>
  </header>

  <!-- Search & Filters -->
  <main class="max-w-7xl mx-auto px-6 mt-8">
    <div class="flex flex-col md:flex-row md:items-center md:space-x-6 mb-6 gap-4">
      <input
        type="search"
        id="searchInput"
        placeholder="Search for movies or TV series..."
        class="flex-grow bg-glass rounded-md border border-borderGlass px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition"
        autocomplete="off"
        autofocus
      />
      <select id="genreFilter" class="bg-glass border border-borderGlass rounded-md px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 transition max-w-xs">
        <option value="">All Genres</option>
      </select>
    </div>

    <!-- Results Grid -->
    <section id="results" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6"></section>

    <!-- Loading Spinner -->
    <div id="loading" class="flex justify-center py-8 hidden">
      <svg class="animate-spin h-10 w-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
      </svg>
    </div>
  </main>

  <script>
    (() => {
      const API_KEY = "e3afd4c89e3351edad9e875ff7a01f0c";
      const BASE_URL = "https://api.themoviedb.org/3";
      const IMAGE_BASE = "https://image.tmdb.org/t/p/w300";

      // Elements
      const toggleType = document.getElementById("toggleType");
      const typeLabel = document.getElementById("typeLabel");
      const searchInput = document.getElementById("searchInput");
      const genreFilter = document.getElementById("genreFilter");
      const results = document.getElementById("results");
      const loading = document.getElementById("loading");

      // State
      let currentType = "movie"; // 'movie' or 'tv'
      let currentQuery = "";
      let currentPage = 1;
      let totalPages = 1;
      let currentGenre = "";
      let isLoading = false;

      // Debounce utility
      function debounce(fn, delay) {
        let timeout;
        return (...args) => {
          clearTimeout(timeout);
          timeout = setTimeout(() => fn(...args), delay);
        };
      }

      // Update toggle label text
      function updateToggleLabel() {
        typeLabel.textContent = currentType === "movie" ? "Movies" : "TV Series";
      }

      // Fetch genres for movies and TV and populate genreFilter dropdown
      async function fetchGenres(type) {
        try {
          const res = await fetch(`${BASE_URL}/genre/${type}/list?api_key=${API_KEY}&language=en-US`);
          const data = await res.json();
          populateGenreDropdown(data.genres);
        } catch (e) {
          console.error("Error fetching genres:", e);
        }
      }

      // Populate genre dropdown
      function populateGenreDropdown(genres) {
        genreFilter.innerHTML = `<option value="">All Genres</option>`;
        genres.forEach(({ id, name }) => {
          const option = document.createElement("option");
          option.value = id;
          option.textContent = name;
          genreFilter.appendChild(option);
        });
      }

      // Clear current results
      function clearResults() {
        results.innerHTML = "";
      }

      // Show/hide loading spinner
      function showLoading(show) {
        loading.style.display = show ? "flex" : "none";
        isLoading = show;
      }

      // Create card HTML for a movie or TV item
      function createCard(item) {
        // For movie: title, release_date; for tv: name, first_air_date
        const title = item.title || item.name || "Untitled";
        const date = item.release_date || item.first_air_date || "";
        const posterPath = item.poster_path ? IMAGE_BASE + item.poster_path : null;
        // Link to TMDB page
        const tmdbUrl = `https://www.themoviedb.org/${currentType}/${item.id}`;

        return `
          <a href="${tmdbUrl}" target="_blank" rel="noopener noreferrer" class="block bg-glass rounded-md overflow-hidden shadow-lg hover:shadow-indigo-500 transition">
            ${posterPath ? `<img src="${posterPath}" alt="${title}" loading="lazy" class="w-full h-auto object-cover"/>` :
              `<div class="flex items-center justify-center h-44 bg-gray-700 text-gray-400 font-semibold">No Image</div>`}
            <div class="p-3">
              <h3 class="font-semibold truncate" title="${title}">${title}</h3>
              <p class="text-sm text-gray-400">${date}</p>
            </div>
          </a>
        `;
      }

      // Fetch search results
      async function fetchResults() {
        if (isLoading) return;
        if (currentPage > totalPages) return;

        showLoading(true);

        const genreParam = currentGenre ? `&with_genres=${currentGenre}` : "";

        // If no query, do nothing or show popular (optional) - here we just do nothing.
        if (!currentQuery.trim()) {
          clearResults();
          showLoading(false);
          return;
        }

        try {
          const url = `${BASE_URL}/search/${currentType}?api_key=${API_KEY}&language=en-US&query=${encodeURIComponent(
            currentQuery
          )}&page=${currentPage}${genreParam}`;
          const res = await fetch(url);
          const data = await res.json();

          totalPages = data.total_pages;

          if (currentPage === 1) clearResults();

          if (data.results.length === 0 && currentPage === 1) {
            results.innerHTML = `<p class="col-span-full text-center text-gray-400">No results found.</p>`;
          } else {
            const cardsHtml = data.results.map(createCard).join("");
            results.insertAdjacentHTML("beforeend", cardsHtml);
          }

          currentPage++;
        } catch (e) {
          console.error("Error fetching search results:", e);
        } finally {
          showLoading(false);
        }
      }

      // Handle type toggle switch
      toggleType.addEventListener("change", () => {
        currentType = toggleType.checked ? "tv" : "movie";
        updateToggleLabel();
        currentPage = 1;
        totalPages = 1;
        currentGenre = "";
        genreFilter.value = "";
        fetchGenres(currentType);
        fetchResults();
      });

      // Handle genre change
      genreFilter.addEventListener("change", () => {
        currentGenre = genreFilter.value;
        currentPage = 1;
        totalPages = 1;
        fetchResults();
      });

      // Handle search input with debounce
      searchInput.addEventListener("input", debounce(() => {
        currentQuery = searchInput.value.trim();
        currentPage = 1;
        totalPages = 1;
        fetchResults();
      }, 500));

      // Infinite scrolling
      window.addEventListener("scroll", () => {
        if (
          window.innerHeight + window.scrollY >=
          document.body.offsetHeight - 300
        ) {
          fetchResults();
        }
      });

      // Init page
      function init() {
        updateToggleLabel();
        fetchGenres(currentType);
        // Optionally can focus input here
        searchInput.focus();
      }

      init();
    })();
  </script>
</body>
</html>
